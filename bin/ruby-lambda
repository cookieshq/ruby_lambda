#!/usr/bin/env ruby

require "#{::File.dirname(__FILE__)}/../lib/ruby_lambda"

class RubyLambdaCLI < Thor
  class_option :quiet, type: :boolean, default: false, aliases: :q

  map '-v' => :version, '--version' => :version
  desc '-v (--versions)', 'Outputs the version of Ruby_Lambda.'
  def version
    puts RubyLambda::VERSION
  end

  desc 'init', 'Uses the current directory as a lambda ruby project (creates `main.rb`, `.ruby-version`, and `Gemfile`).'
  def init
    RubyLambda::Init.new(FileUtils.pwd).run(mute: options[:quiet])
  end

  desc 'execute', 'Invokes the function locally'
  long_desc <<-LONGDESC
    This command is used to invoke / run the function locally

    With -c / --config flag to pass a custom config file to use

    With -H, [--handler=HANDLER]
  LONGDESC

  option :config, default: 'config.yml', type: :string, aliases: :c
  option :handler, type: :string, aliases: :H
  def execute
    RubyLambda::Execute.new(FileUtils.pwd, options).run
  end

  desc 'build', 'Builds your application into a local zip file'
  long_desc <<-LONGDESC
    This command will create a zipped file ready to be published on Lambda

    With -n / --native-extensions flag to pass build gems with native extensions
  LONGDESC

  option :native_extensions, type: :boolean, default: false, aliases: :n
  def build
    RubyLambda::Build.new(FileUtils.pwd, options).run(mute: options[:quiet])
  end
end

RubyLambdaCLI.start(ARGV)
